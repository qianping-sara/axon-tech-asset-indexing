generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



model axon_asset {
  id                                                              String                @id
  name                                                            String                @db.VarChar(255)
  description                                                     String
  category                                                        Category
  assetType                                                       String                @db.VarChar(100)
  version                                                         String                @db.VarChar(50)
  status                                                          Status                @default(PUBLISHED)
  owner                                                           String                @db.VarChar(255)
  contentPath                                                     String                @db.VarChar(500)
  contentHash                                                     String                @db.VarChar(64)
  sourceSystem                                                    String                @db.VarChar(100)
  sourceLink                                                      String                @db.VarChar(500)
  createdAt                                                       DateTime              @default(now())
  updatedAt                                                       DateTime
  publishedAt                                                     DateTime?
  axon_asset_relation_axon_asset_relation_fromAssetIdToaxon_asset axon_asset_relation[] @relation("axon_asset_relation_fromAssetIdToaxon_asset")
  axon_asset_relation_axon_asset_relation_toAssetIdToaxon_asset   axon_asset_relation[] @relation("axon_asset_relation_toAssetIdToaxon_asset")
  axon_asset_tag                                                  axon_asset_tag[]
  axon_asset_version                                              axon_asset_version[]

  @@index([category])
  @@index([owner])
  @@index([status])
  @@index([updatedAt])
  @@map("axon_asset")
}

model axon_asset_relation {
  id                                                     String       @id
  fromAssetId                                            String
  toAssetId                                              String
  relationType                                           RelationType
  createdAt                                              DateTime     @default(now())
  updatedAt                                              DateTime
  axon_asset_axon_asset_relation_fromAssetIdToaxon_asset axon_asset   @relation("axon_asset_relation_fromAssetIdToaxon_asset", fields: [fromAssetId], references: [id], onDelete: Cascade)
  axon_asset_axon_asset_relation_toAssetIdToaxon_asset   axon_asset   @relation("axon_asset_relation_toAssetIdToaxon_asset", fields: [toAssetId], references: [id], onDelete: Cascade)

  @@unique([fromAssetId, toAssetId, relationType])
  @@index([fromAssetId])
  @@index([toAssetId])
}

model axon_asset_tag {
  id         String     @id
  assetId    String
  tagId      String
  createdAt  DateTime   @default(now())
  axon_asset axon_asset @relation(fields: [assetId], references: [id], onDelete: Cascade)
  axon_tag   axon_tag   @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([assetId, tagId])
  @@index([assetId])
  @@index([tagId])
}

model axon_asset_version {
  id          String     @id
  assetId     String
  version     String     @db.VarChar(50)
  status      Status
  contentHash String     @db.VarChar(64)
  changeLog   String?
  createdAt   DateTime   @default(now())
  axon_asset  axon_asset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([version])
}

model axon_tag {
  id             String           @id
  name           String           @unique @db.VarChar(100)
  description    String?
  category       String           @db.VarChar(100)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  axon_asset_tag axon_asset_tag[]

  @@index([category])
}

enum Category {
  CODE_COMPONENTS
  SERVICES_APIS
  AI_ML_SERVICES
  AUTOMATION_WORKFLOWS
  DATA_ANALYTICS
  ARCHITECTURE_GOVERNANCE
  KNOWLEDGE_PRACTICES
}

enum RelationType {
  // Structural Relationships
  COMPOSITION  // Strong lifecycle dependency (A is composed of B)
  AGGREGATION  // Weak lifecycle dependency (A aggregates B)
  ASSIGNMENT   // Allocation of responsibility/behavior/storage
  REALIZATION  // A realizes/implements B (concrete implementation of abstract)

  // Dependency Relationships
  SERVING      // A serves/provides functionality to B
  ACCESS       // A accesses/uses B (active element accesses passive element)
  INFLUENCE    // A influences B's implementation/achievement
  ASSOCIATION  // Unspecified relationship
}

enum Status {
  DRAFT
  PUBLISHED
  DEPRECATED
  ARCHIVED
}
